import IO;
import Strings;
import List;

export class Lambda:

static forEach <T> (l: List<T>, f: (T->())) {
    i:int32 = 0;
    while i < l.size() {
        f(l.elements()[i]);
        i = i+1;
    }
}

static filter <F> (l: List<F>, filter: (F->bool)) {
    i:int32 = 0;
    while i < l.size() {
        if filter(l.elements()[i]) {
            l.removeOrdered(i);
        } else {
            i = i+1;
        }
    }
}

static even (i: int64) -> bool {
    return i%2 =*= 0;
}

static buildMat() -> List<List<int64>> {
    matrix := List<List<int64>>.create();
    i:int32 = 0;
    while i<=9 {
        inner := List<int64>.create();
        matrix.add(inner);
        j:int32 = 0;
        while j<=9 {
            inner.add(i*10+j);
            j = j+1;
        }
        i = i+1;
    }
    return matrix;
}

static printMat(mat: List<List<int64>>) {
    forEach(mat, \inner -> {
        forEach(inner, \e -> {
            IO.print(Strings.intToString(e));
            IO.print(", ");
        });
        IO.printLine("");
    });
}

static filterLambda: (int64 -> bool) = \i -> i%3 == 0 ^ i%5 == 0;

export static main () {
    if (filterLambda(12)) {
        IO.printLine("yes");
    }
    matrix := buildMat();
    forEach(matrix, \inner -> filter(inner, \e -> even(e)));
    IO.printLine("\nfilter even 1:");
    printMat(matrix);

    forEach(matrix, \inner -> filter(inner, even**));
    IO.printLine("\nfilter even 2:");
    printMat(matrix);

    matrix = buildMat();
    //forEach(matrix, \inner -> filter(inner, \e -> e%2 == 1)); //TODO get this working
    IO.printLine("\nfilter odd:");
    printMat(matrix);

    matrix = buildMat();
    forEach(matrix, \inner -> filter(inner, filterLambda));
    IO.printLine("\nfilter fizz:");
    printMat(matrix);

    matrix = buildMat();
    forEach(matrix, \inner -> filter(inner, filterLambda));
    forEach(matrix, \inner -> filter(inner, \e -> filterLambda(e)));
    IO.printLine("\nfilter fizz2:");
    printMat(matrix);
}
